<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ViewUI example</title>
    <link rel="stylesheet" type="text/css" href="http://unpkg.com/view-design/dist/styles/iview.css">
    <script type="text/javascript" src="http://vuejs.org/js/vue.min.js"></script>
    <script type="text/javascript" src="http://unpkg.com/view-design/dist/iview.min.js"></script>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
</head>
<body>
<div id="app">
<!--    <i-button @click="show">查询</i-button>-->
    <dic>
        <Form align="center" ref="formCustom" :model="formCustom"  :label-width="80">
            <FormItem label="loginName" prop="loginName">
                <Input placeholder="LoginName" type="text" v-model="formCustom.loginName"></Input>
            </FormItem>
            <FormItem label="username" prop="username">
                <Input placeholder="Username" type="text" v-model="formCustom.username"></Input>
            </FormItem>
            <FormItem label="password" prop="password">
                <Input placeholder="Password" type="text" v-model="formCustom.password" ></Input>
            </FormItem>
            <FormItem>
                <Button type="primary" @click="handleSubmit('formCustom')">新增</Button>
                <Button @click="handleReset('formCustom')" style="margin-left: 8px">重置</Button>
            </FormItem>
        </Form>
    </dic>

    <i-table :columns="columns1" :data="data1">
<!--        修改-->
        <template  slot-scope="{ row, index }" slot="action">
            <Button type="primary" size="small" style="margin-right: 5px" @click="show(index)">View</Button>
            <Button id = "btn" type="error" size="small" @click="remove(row)">删除</Button>
            <Button  type="primary" size="small" @click="openWindow(row)">修改</Button>
        </template>

    </i-table>

    <Modal
            v-model="modal1"
            title="修改"
            @on-ok="update()"
            @on-cancel="handleReset('formCustom')">
        <Form align="center" ref="formCustom1" :model="formCustom1"  :label-width="80">
            <FormItem label="loginName" prop="loginName">
                <Input placeholder="LoginName" type="text" v-model="formCustom1.loginName"></Input>
            </FormItem>
            <FormItem label="username" prop="username">
                <Input placeholder="Username" type="text" v-model="formCustom1.username"></Input>
            </FormItem>
            <FormItem label="password" prop="password">
                <Input placeholder="Password" type="text" v-model="formCustom1.password" ></Input>
            </FormItem>
        </Form>
    </Modal>

    <!--    <Button type="error" size="small" @click="remove(index)">Delete</Button>-->
<!--    <Button @click="handleSelectAll(true)">Set all selected</Button>-->
<!--    <Button @click="handleSelectAll(false)">Cancel all selected</Button>-->
<!--    <Page :total="100" ></Page>-->
</div>
<script>
    new Vue({
        el: '#app',
        data: {
            columns1: [
                {
                    type: 'selection',
                    width: 60,
                    align: 'center'
                },
                {
                    title: 'id',
                    key: 'id'
                },
                {
                    title: 'loginName',
                    key: 'loginName'
                },
                {
                    title: 'username',
                    key: 'username'
                },
                {
                    title:'password',
                    key:'password'
                },
                {
                    title: 'Action',
                    slot: 'action',
                    width: 150,
                    align: 'center'
                }
            ],
            data1: [
            ],
            formCustom: {
                loginName: '',
                username: '',
                password: ''
            },
            formCustom1: {
                loginName: '',
                username: '',
                password: '',
                id:''
            },
            modal1: false
        },
        methods: {
            handleSelectAll (status) {
                this.$refs.selection.selectAll(status);
            },
            query(){
                let that = this
                $.ajax({
                    url: "http://localhost:8080/user/findStu",
                    //dataType: "json",
                    type: "Get",
                    success: function (data) {
                        that.data1 = data
                    }
                    // error: function(data) {
                    //     alert("请求出错");
                    //     alert(data);
                    // }
                });
            },
            show (index) {
                this.$Modal.info({
                    title: 'User Info',
                    content: `loginName：${this.data1[index].loginName}<br>username：${this.data1[index].username}<br>password：${this.data1[index].password}`
                })
            },
            remove (row) {
                let that = this
                $.ajax({
                    url: "http://localhost:8080/user/deletes/"+row.id,
                    //dataType: "json",
                    type: "Post",
                    success: function (data) {
                        that.query();
                    }
                    // error: function(data) {
                    //     alert("请求出错");
                    //     alert(data);
                    // }
                });

            },
            handleSubmit (name) {
                let that = this
                $.ajax({
                    url: "http://localhost:8080/user/insertGetKey",
                    //dataType: "json",
                    type: "Post",
                    data:that.formCustom,
                    success: function (data) {
                        // alert(data)
                        // console.log
                        // debugger
                        that.query();

                    }
                    // error: function(data) {
                    //     alert("请求出错");
                    //     alert(data);
                    // }
                });
            },
            update(name){
                let that = this
                $.ajax({
                    url: "http://localhost:8080/user/upDate",
                    //dataType: "json",
                    type: "post",
                    data:that.formCustom1,
                    success: function (data) {
                        // alert(data)
                        // console.log
                        // debugger
                        that.query();

                    }
                    // error: function(data) {
                    //     alert("请求出错");
                    //     alert(data);
                    // }
                });
            },
            handleReset (name) {
                this.$refs[name].resetFields();
            },
            handleEdit (row, index) {
                debugger
                this.editloginName = row.loginName;
                this.editusername = row.username;
                this.editpassword = row.password;
                this.editIndex = index;
            },
            handleSave (index) {
                // this.data[index].loginName = this.editloginName;
                // this.data[index].username = this.editusername;
                // this.data[index].password = this.editpassword;
                // this.editIndex = -1;
            },
            openWindow(row){
                this.modal1 = true;
                this.formCustom1.id =row.id
            }
        },
            created() {
            this.query()
            }
    })
</script>
</body>
</html>